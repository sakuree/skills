# 创建数据库主子表插件

URL: https://hc.jiandaoyun.com/open/18196

## 1. 简介

### 1.1 插件简介

创建数据库主子表插件，支持根据简道云表单、字段别名，自动创建数据库主子表、字段。若表单中包含多个子表单，则支持同时创建多个字表数据。

注：

1）不支持自动创建图片和附件字段。

2）主子表均自动创建 dataid 字段作为关联字段。

### 1.2 应用场景

该插件常用于主数据/业务数据同步前，先创建或者更新数据库表和字段，以便能接收表单的全部字段数据的场景中。如人员、组织、客户、产品、物料等主数据同步前；合同、订单、费用等业务数据同步前等。

### 1.3 预期效果

开启创建数据库主子表插件，在「标准订单」表单中设置智能助手定时任务后，在指定时间自动创建或者更新数据库表和字段。效果如下所示：

![](https://help-assets.jiandaoyun.com/7173c86b-4014-4290-a01b-a7cac30e8c15)

### 1.4 使用说明

1）该插件需要具有 API 权限才能使用。

2）创建数据库主子表为付费插件，请联系我们增购。插件购买流程如下所示：

![](https://help-assets.jiandaoyun.com/2597b727-68f5-45c2-9587-e18ec29e1812)

## 2. 插件安装及配置

### 2.1 安装插件

1）直接安装

* 您可点击右方链接直接安装插件：[创建数据库主子表插件安装](https://www.jiandaoyun.com/open/store/plugin?plugin_id=653f519f426a718bc039061b)。
* 安装成功后，可参考本文【2.2 配置插件】和【2.3 启用插件】，前往「开放平台 >> [插件管理](https://hc.jiandaoyun.com/open/12278)」处配置并启用插件。

2）插件市场处安装

在简道云「插件市场」处，安装「创建数据库主子表」插件。插件市场处安装方法可参见文档：[插件市场中【2.3 插件安装】](https://hc.jiandaoyun.com/open/13150)。

![](https://help-assets.jiandaoyun.com/6b954b10-3518-4dff-874a-7a271a91bf24)

### 2.2 配置插件

1）安装后，在「插件管理」处，点击插件右侧的「设置」按钮，根据企业数据库信息，将「简道云 API Key」、「数据库类型」、「主机地址」、「端口号」、「数据库账号」、「数据库密码」、「数据库名称」等信息配置进去，配置完成后点击确定。

![](https://help-assets.jiandaoyun.com/a5e2aaac-798b-4903-8276-93250629eaed)

2）进入「开放平台 >> 密钥管理」处，即可查看并复制对应的简道云 API Key。

![](https://help-assets.jiandaoyun.com/98c15c52-608e-4236-99d7-3a574f9d5f15)

### 2.3 启用插件

在插件管理中，打开「创建数据库主子表」插件右侧开关，启用插件。

![](https://help-assets.jiandaoyun.com/b8b880bd-7082-4ebc-aa8a-0d1ab6fec9f0)

## 3. 表单搭建

插件使用体验可先安装：[创建数据库主子表模板表单](https://www.jiandaoyun.com/a/6540632bec5af2b1c7175345)。本文将按照示例表单进行讲解。

### 3.1 创建表单

以订单业务为例，新建「标准订单」表单，字段设置如下所示：

|  |  |
| --- | --- |
| **字段名称** | **字段类型** |
| 订单编号 | 单行文本 |
| 客户名称 |
| 客户ID |
| 产品名称 |
| 产品编码 |
| 单位 |
| 单价 | 数字 |
| 销售数量 |
| 销售金额 |
| 备注 | 单行文本 |
| 收货联系人 |
| 收货联系电话 |
| 收货地址 |
| 创建时间 | 日期时间 |
| 创建人员 | 单行文本 |
| 创建部门 |

![](https://help-assets.jiandaoyun.com/da88bae5-da6c-4f64-864c-877616bd2bc7)

### 3.2 设置字段别名

进入「扩展功能 >> 数据推送」中，点击设置字段别名，依次将字段别名设置为数据库对应字段的名称，设置完成后，点击「保存」按钮。设置如下所示：

|  |  |
| --- | --- |
| **字段名称** | **字段别名** |
| 订单编号 | code |
| 客户名称 | name |
| 客户ID | customer\_name |
| 产品名称 | product\_name |
| 产品编码 | product\_code |
| 单位 | unit |
| 单价 | price |
| 销售数量 | sale\_number |
| 销售金额 | sale\_money |
| 备注 | remark |
| 收货联系人 | link\_people |
| 收货联系电话 | phone |
| 收货地址 | address |
| 创建时间 | create\_time |
| 创建人员 | create\_people |
| 创建部门 | create\_deot |

![](https://help-assets.jiandaoyun.com/219ffe9d-9ee7-432f-9e53-f7a4e54a2af5)

## 4. 智能助手配置

该插件支持在 [前端事件](https://hc.jiandaoyun.com/doc/11825) 和 [智能助手](https://hc.jiandaoyun.com/doc/11021) 中调用触发，本文以智能助手调用触发为例，进行插件的调用配置。如下所示：

### 4.1 添加智能助手

设计完表单后，在「扩展功能」处添加「智能助手」，并修改智能助手名称为「创建数据库主子表」。

![](https://help-assets.jiandaoyun.com/0ff36c78-c4d4-433d-9c62-0e02b645bed2)

### 4.2 设置触发动作

由于需要每日触发智能助手同步数据库数据，故「触发动作」选择「定时重复」，详细配置项如下所示：

* 触发动作：设置为「定时重复」；
* 触发时间：表示何时开始触发智能助手任务，必填项，精确到秒。如设置为 2023-10-24 14:00:00；
* 重复类型：下拉框选择为「每天」；
* 重复触发结束时间：表示何时结束触发智能助手任务；必填，精确到秒，不可早于「触发时间」。如设置为 2023-12-31 17:30:00。

![](https://help-assets.jiandaoyun.com/120e6003-922a-4652-8723-17057ea9f8e2)

### 4.3 设置执行动作

1）选择「创建数据库主子表」插件，如下图所示：

![](https://help-assets.jiandaoyun.com/063da373-59f1-4505-be9e-5ee2e27ac9d3)

2）设置「表单」「应用 ID」「表单 ID」「数据库主表名称」，设置完成后点击「完成」，如下图所示：

* 表单：选择当前表单；
* 应用 ID / 表单 ID：分别以「字段值」方式，选择「应用 ID」「表单 ID」；
* 数据库主表名称：以「自定义」方式输入数据库主表名称；

![](https://help-assets.jiandaoyun.com/af966e88-1127-49b1-8e71-3e9f85ad0d99)

### 4.4 效果演示

效果参见本文【1.3 预期效果】。

## 5. 注意事项

### 5.1 数据库说明

1）目前仅支持 mysql/sqlserver/postgresql 数据库。如希望增加更多数据库，可通过下方联系方式联系开发者增加。

注：mysql 通常默认的是 3306 端口，sqlserver 默认的是 1433 端口，postgresql 数据库，默认的端口号为 5432。

2）本地部署的数据库如具备允许公网访问的固定 IP，则可使用此插件；暂不支持公网访问的本地数据库。如您的数据库 IP 属于如下所示的局域网 IP 地址，则不支持访问：

* 10.0.0.0 - 10.255.255.255
* 172.16.0.0 - 172.31.255.255
* 192.168.0.0 -192.168.255.255

### 5.2 字段增删说明

通过表单字段的字段别名与数据库的字段名称做对比：（仅针对设置了字段别名的字段参与比对）

* 增加数据库字段：表单**有**该字段别名，数据库**无**该字段名称；
* 删除数据库字段：表单**无**该字段别名，数据库**有**该字段名称；

### 5.3 IP地址白名单

如果您的数据库允许外放访问但需要 IP 地址加白名单，请设置白名单 IP 为： 47.97.99.12。

## 6. 联系方式

该插件为官方合作的服务商开发，若您在使用过程中有任何疑问，可通过以下方式咨询：

* 公司：成都轻如燕企业服务有限公司
* 联系人：赵鹏
* 联系电话：18583980516（微信同号）
* 数据库类插件交流群，二维码如下：

![](https://help-assets.jiandaoyun.com/b3a16434-1f57-4a71-8d83-441a2dca72f6?attname=%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E6%8F%92%E4%BB%B6%E4%B8%9A%E5%8A%A1%E4%BA%A4%E6%B5%81%E7%BE%A4.png)